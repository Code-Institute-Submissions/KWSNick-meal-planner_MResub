{% extends "base.html" %}
{% block content %}
<div class="row">
    <div class="col s12 center">
        <h1>Weekly Menus</h1>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="center-align">
            <h4 id="create_menu_header">Create a new menu</h4>
        </div>
        <div>
            <form method="POST" action="{{ url_for('weekly_menus') }}">
                <div class="input-field col s6 m4">
                    <!--Enters the current year as the default option-->
                    <input class="center" id="year_select" name="year_select" type="number" value="{{ year }}" required>
                    <label for="ingredient_quantity1">Year</label>
                </div>
                <div class="input-field col s6 m4">
                    <!--Sets the current month as the default option-->
                    {% set month_id = month %}
                    <select class="center" id="month_select" name="month_select" required>
                        <option value="{{ month }}" selected>{{ month_name }}</option>
                        <option value="1">January {% set month_id = 1 %}</option>
                        <option value="2">February</option>
                        <option value="3">March</option>
                        <option value="4">April</option>
                        <option value="5">May</option>
                        <option value="6">June</option>
                        <option value="7">July</option>
                        <option value="8">August</option>
                        <option value="9">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>
                    <label for="month_select">Month</label>
                </div>
                <div class="col s6 m4">
                    <!--When this button is pressed the year and month is sent to the routing method and if the week_select has no valid week selected
                                    then it refreshes the page but has obtained weeks to select.-->
                    <button id="get_weeks_btn" class="col s12 waves-effect waves-light btn-large amber darken-1"
                        type="submit">Get Weeks</button>
                </div>
                <div class="row">
                    <div class="input-field center col s6 m8">
                        {% set i = namespace(value=0) %}
                        <select class="center" id="week_select" name="week_select" required>
                            <option value="no weeks" selected>Weeks</option>
                            <!--If the week begins in another month the week is ignored.-->
                            {% for week in cal %}
                            {% if week.0 == 0 %}
                            <!--If the week begins in the month then the first item is used to show an option to the user.-->
                            {% else %}
                            <option value="{{ i.value }}">
                                W/C:
                                {% if week.0 == 1 %}
                                {{ week.0 }}st,
                                {% elif week.0 == 2 %}
                                {{ day }}nd,
                                {% elif week.0 == 3 %}
                                {{ week.0 }}rd,
                                {% else %}
                                {{ week.0 }}th,
                                {% endif %}
                            </option>
                            {% endif %}
                            {% set i.value = i.value + 1 %}
                            {% endfor %}
                        </select>
                        <label for="week_select">Week</label>
                    </div>
                    <div class="col s12 m4 center">
                        <button id="create_btn" class="col s12 waves-effect waves-light btn-large green lighten-1" type="submit">Create</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
    <div class="row">
        <ul class="collapsible">
           <li>
            {% if plans|length == 0 %}
                <div class="collapsible-header center"><h5 class="col s12 red-text text-darken-1">No Plans Found</h5></div>
            {% endif %}
            </li>
            {% if plans|length > 0 %}
            {% for plan in plans %}
            {% if session.wft_user[0] == plan.owner %}
            <li>
                <div class="collapsible-header center"><h5 class="col s12">Week Commencing {{ plan.days[0] }}/{{ plan.month }}/{{ plan.year }}</h5></div>
                <div class="collapsible-body row">
                {% set j = namespace(value=0) %}
                {% for meal in plan.meals %}
                    {% for recipe in recipes %}
                        {% if recipe._id == meal._id %}
                            <div class="col s6 m4 l3 left">
                                <div class="card weekly_plan_card">
                                    <div class="col s12 center">
                                        <h5>{% if j.value == 0 %}
                                                Monday
                                            {% elif j.value == 1 %}
                                                Tuesday
                                            {% elif j.value == 2 %}
                                                Wednesday
                                            {% elif j.value == 3 %}
                                                Thursday
                                            {% elif j.value == 4 %}
                                                Friday
                                            {% elif j.value == 5 %}
                                                Saturday
                                            {% elif j.value == 6 %}
                                                Sunday
                                            {% endif %}
                                        </h5>
                                    </div>
                                    <div class="card-image">
                                        <img src="{{ recipe.image_url }}" alt="{{ recipe.image_description }}">
                                        <a href="{{ url_for('recipe_view', recipe_id=recipe._id) }}"
                                            class="hoverable btn-floating btn-large halfway-fab waves-effect waves-light red"><i
                                                class="fas fa-book-open"></i></a>
                                    </div>
                                    <div class="card-content">
                                        <span class="card-title">
                                            <h5>{{ recipe.recipe_name.capitalize() }}</h5>
                                        </span>
                                        <div class="row">
                                            <div class="col s12 center">
                                                <p><strong>
                                                        <h6>Classification:</h6>{{ recipe.classification.capitalize() }}
                                                    </strong></p>
                                            </div>
                                            <div class="col s12 center">
                                                <p><strong>
                                                        <h6>Region of Origin:</h6>{{ recipe.region_of_origin.capitalize() }}
                                                    </strong></p>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col m12 hide-on-med-and-down center">
                                                <p>{{ recipe.description.capitalize() }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                    {% set j.value = j.value + 1 %}
                {% endfor %}
                </div>
            </li>
            {% endif %}
            {% endfor %}
            {% endif %}
        </ul>
    </div>
{% endblock %}